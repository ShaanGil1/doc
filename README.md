# Doccano + Postgres Auto-Loaded Demo (GCP/Azure Tagging)

This demo shows a **closed-loop human review pipeline**:
1) Postgres stores **candidate** tags and alias pairs generated by automated processes (LLM + heuristics).
2) Doccano provides the **review UI** (approve/reject/unsure + optional comment).
3) A small “bridge” service **exports reviewer decisions back into Postgres** to update the source-of-truth tables.

## What we use Doccano for
- **Tag QA**: accept/reject candidate tags for a doc based on evidence.
- **Alias QA**: decide if two terms are aliases, and if so, pick the preferred canonical form (A / B / Unified).

## Quick start (Windows / PowerShell)
From the folder containing `docker-compose.yml`:

```powershell
docker compose up -d --build
```

Doccano UI: http://localhost:8000  
Login: `admin` / `password`

## Demo script (5–7 minutes)
### 1) State the problem (30s)
“We can extract tags automatically, but we need a reliable way to (1) filter quality and (2) distill duplicates.”

### 2) Prove candidates are in Postgres (60s)
```powershell
docker compose exec -T postgres psql -U taguser -d tagdemo -c "SELECT COUNT(*) FROM tag_qa_candidates;"
docker compose exec -T postgres psql -U taguser -d tagdemo -c "SELECT COUNT(*) FROM alias_qa_pairs;"
```

Show reviewer fields are empty initially:
```powershell
docker compose exec -T postgres psql -U taguser -d tagdemo -c "SELECT candidate_id, tag_name, reviewer_label, reviewed_at FROM tag_qa_candidates ORDER BY candidate_id;"
docker compose exec -T postgres psql -U taguser -d tagdemo -c "SELECT pair_id, word_one, word_two, reviewer_label, reviewed_at FROM alias_qa_pairs ORDER BY pair_id;"
```

### 3) Label a few items in Doccano (2–3 min)
- Project: **Tag QA (Demo)** → label TAG_GOOD / TAG_BAD / TAG_UNSURE
- Project: **Alias QA (Demo)** → label ALIAS_*  
  - If you pick `*_PREF_UNIFIED`, put the preferred canonical format in the comment (example: `Google Kubernetes Engine (GKE)`).

### 4) Export decisions back to Postgres (60s)
```powershell
docker compose run --rm bridge export
```

Verify DB updates:
```powershell
docker compose exec -T postgres psql -U taguser -d tagdemo -c "SELECT candidate_id, tag_name, reviewer_label, reviewer_comment, reviewed_at FROM tag_qa_candidates ORDER BY candidate_id;"
docker compose exec -T postgres psql -U taguser -d tagdemo -c "SELECT pair_id, word_one, word_two, reviewer_label, reviewer_comment, reviewed_at FROM alias_qa_pairs ORDER BY pair_id;"
```

### 5) Close (30s)
“Now our alias table + approved tags become reusable knowledge that improves future extraction.”

## Fresh run (fully reproducible reset)
```powershell
docker compose down -v
docker compose up -d --build
```

## Edit mock data (10 examples each)
- `postgres/init/tag_qa.csv`
- `postgres/init/alias_qa.csv`

After edits, do a fresh run reset.

## Troubleshooting
Bridge bootstrap logs:
```powershell
docker compose logs bridge_bootstrap --tail 200
```
Postgres logs:
```powershell
docker compose logs postgres --tail 200
```
